<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />

    <!-- <meta name="viewport" content="width=device-width, initial-scale=1" /> -->
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0 " />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Web site created using create-react-app" />


    <title>青年党史“晓”馆</title>
    <link rel="icon" href="%REACT_APP_BASE_URL%/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="%REACT_APP_BASE_URL%/reset.css">
    <link rel="stylesheet" href="%REACT_APP_BASE_URL%/font.css">


</head>

<body>

    <div id="root"></div>
    <script>
        const token = document.location.href.split('token=')[1];
        let today = Date.parse(new Date())
        console.log(today)
        if (0) {
            localStorage.removeItem('id_token')
            localStorage.removeItem('time')
        }
        if (today - localStorage.getItem('time') > 8640000) {
            let date = Date.parse(new Date())
            console.log(date)
            localStorage.setItem('time', date)
            window.location.href =
                'https://be-prod.redrock.team/magicloop/rushb?b=' +
                encodeURI('https://be-prod.redrock.team/four-history') +
                '&scope=student';
        }
        console.log(token);
        if (token && token.length) {
            document.location.hash = '#/';
            localStorage.setItem('id_token', token.replace(/%20/g, '+').replace(/#[\w/]*/g, ''));
            const {
                exp,
                stuNum,
                role
            } = JSON.parse(atob(token.split('.')[1]));
            localStorage.setItem('exp', exp);
            localStorage.setItem('stuNum', stuNum);
            localStorage.setItem('role', role);
        }
        if (
            (!localStorage.getItem('id_token') ||
                parseInt(localStorage.getItem('exp')) <
                Math.floor(Date.now() / 1000) + 60 * 60 * 24 * 2) &&
            !token
        ) {
            let date = Date.parse(new Date())
            console.log(date)
            localStorage.setItem('time', date)
            window.location.href =
                'https://be-prod.team/magicloop/rushb?b=' +
                encodeURI('https://be-prod.redrock.team/four-history') +
                '&scope=student';
        }
    </script>
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?c92cd0fa0888f33d5e9cd257f0a15ffb";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

</body>

</html>